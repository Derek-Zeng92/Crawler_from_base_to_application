TY.namespace("m"),TY.loadedModule("TY.m.openApp"),"undefined"==typeof window.TY.m.openApp&&(TY.m.openApp=function(t){this.init(t)}),function(t){TY.extend(t.prototype,{setConfig:function(t){var i={pmType:"home",logo:"add-logo-default",text:"打开",title:"天涯社区",url:"",PcDownloadAppUrl:"http://www.tianya.cn/mobile/",wxOpenApp:"http://bbs.tianya.cn/m/weixin.html?isappinstalled=0&tianya=1&openurl=",desc:"全球华人兴趣社交平台",itemId:"",artId:"",videoId:"",pm:"bbs-index"},p=this;p.args=TY.extend({},i,t),TY.extend(p.args,{url:p.getUrl({pmType:p.args.pmType,itemId:p.args.itemId,artId:p.args.artId,videoId:p.args.videoId})}),0==this.args.isPadding&&(this.args.padding=0)},getUrl:function(t){switch(t.pmType){case"home":return"tianyaqing://home";case"list":return"tianyaqing://bbsList?categoryId="+t.itemId;case"post":return"tianyaqing://noteDetail?categoryId="+t.itemId+"&noteId="+t.artId;case"video":return"tianyaqing://visionDetail?categoryId="+t.itemId+"&noteId="+t.artId+"&videoId="+t.videoId;case"liveShare":return"tianya://live/roomurl?forwardURL=http://www.tianya.cn/m/show/share/"+t.artId}},createHtml:function(){var t=this,i=t.args,p=['<style type="text/css">',".app-tips {","background: #EEE;","padding: 8px; }",".app-tips-fixed {","position: fixed;","z-index: 100;","width: 100%;","max-width: 800px;","-webkit-box-sizing: border-box;","-moz-box-sizing: border-box;","box-sizing: border-box;","background: rgba(0, 0, 0, 0.75);","padding-right: 40px; }",".app-tips-fixed .app-tips-close {","font-size: 20px;","text-align: center;","position: absolute;","width: 30px;","height: 30px;","line-height: 30px;","right: 0;","top: 8px;","color: #ffffff; }",".app-tips-top .app-logo,",".app-tips-fixed .app-logo {","float: left;","width: 30px;","height: 30px;","margin: 0 10px 0 0; }",".app-tips-top .app-logo,",".app-tips-fixed .app-logo {","background: url./images/weilun-icon.png;","background-size: 30px 30px; }",".app-tips-top .app-logo-daily,",".app-tips-fixed .app-logo-daily {","background: url./images/daily-icon.png;","background-size: 30px 30px; }",".app-tips-top .u-btn,",".app-tips-fixed .u-btn {","padding: 4px 6px;","background-color: #308ee3;","color: #ffffff;","font-size: 14px;","-webkit-border-radius: 4px;","border-radius: 4px;","line-height: 20px;","height: 20px; }",".app-tips-top p,",".app-tips-fixed p {","font-size: 12px;","color: #ffffff;","line-height: 16px;margin:0; }",".app-tips-top p a,",".app-tips-fixed p a {","color: #ffffff;","font-size: 14px;text-decoration:none; }",".app-tips-top .app-tips-right,",".app-tips-fixed .app-tips-right {","margin: 5px 0 0; }",".app-tips-fixed .app-tips-right {","float:right; }",".app-tips-bottom {","padding: 15px 10px; }",".app-tips a{text-decoration:none;}","</style>",'<div class="app-tips app-tips-fixed f-cf">','<div class="app-tips-right f-fr">','<a href="'+i.url+'" class="u-btn u-btn-blue">立即'+i.text+"</a>","</div>",'<div class="app-tips-left">','<div class="app-logo '+i.logo+'"></div>','<p><a href="'+i.url+'">'+i.title+"</a><br>"+i.desc+"</p>","</div>",'<a class="app-tips-close" href="javascript:;">&times;</a>',"</div>"].join("");TY("body").append(p).addClass("formapp")},bindEvent:function(){TY(".app-tips-close").click(function(){TY(this).parent().remove(),TY("body").css("padding-bottom","0"),TY("#j-gotop").css("bottom","0")})},openLogic:function(t,i){function p(t){return-1!=t.indexOf("?")?t+"&":t+"?"}function e(t){if(-1!=location.href.indexOf(t)){var i=location.href.split(t);return i[1].substr(1)}}function a(){setTimeout(function(){""!=c&&(window.location=c)},2e3)}var o=this,n=o.args,s="micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?!0:!1,r=TY(t),d=i?i:n.url,c=o.downloadChoose(),l=e("openApp");s&&(d=n.wxOpenApp+encodeURIComponent(p(window.location.href)+"openApp="+d)),TY.mobile.isMobile()?(r.bind("click",function(){s||a()}),l&&!s&&(window.location=l,a())):(d=n.PcDownloadAppUrl,r.attr("target","top")),r.attr("href",d)},downloadChoose:function(){var t=TY.mobile.browser;return t.isAndroid?"http://yy.tianya.cn/appClient":t.isIpad?"https://itunes.apple.com/cn/app/id570630462?mt=8":t.isIphoneOs?"http://itunes.apple.com/cn/app/tian-ya-she-qu/id529696004?mt=8":""},linkSource:function(){var t=0,i=document.referrer,p=TY.param.getHrefParam(),e=p.f,a=(p.isappinstalled,"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?!0:!1);return t=a?3:e&&/^[iac]$/i.test(e)?2:""==i||""!=i&&-1==i.indexOf(".tianya.cn")?1:0},clickStat:function(){var t=this.linkSource(),i=this,p=i.args,e=["站内","站外","天涯客户端","微信"];TY.clickStat("pm-openapp-m-"+p.pm+"-展示-"+e[t]),"undefined"!=typeof TY.clickStat&&(TY("body").delegate(".app-tips-right a,app-tips-left p a","click",function(){TY.clickStat("pm-openapp-m-"+p.pm+"-打开-"+e[t])}),TY("body").delegate(".app-tips-close","click",function(){TY.clickStat("pm-openapp-m-"+p.pm+"-关闭-"+e[t])}))},clickStatByBtn:function(t){var i=this.linkSource(),p=["站内","站外","天涯客户端","微信"];TY.clickStat("pm-openapp-m-"+t.pm+"-展示-"+p[i]),"undefined"!=typeof TY.clickStat&&t.btn.bind("click",function(){TY.clickStat("pm-openapp-m-"+t.pm+"-打开-"+p[i])})},init:function(t){var i=this,p=t.customBtnUrl;if(this.setConfig(t),p){if(p instanceof Array)for(var e=0;e<p.length;e++)this.openLogic(p[e].btn,i.getUrl({pmType:p[e].pmType,itemId:p[e].itemId,artId:p[e].artId,videoId:p[e].videoId})),this.clickStatByBtn(p[e])}else this.createHtml(),this.bindEvent(),this.openLogic(".app-tips-left a,.app-tips-right a"),this.clickStat()}})}(TY.m.openApp);